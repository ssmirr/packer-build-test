dist: bionic
language: generic
before_install:
# [WIP] attempting to run vagrant
  - cat /proc/cpuinfo
  - free -m
  - wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add - && sudo sh -c "echo deb https://download.virtualbox.org/virtualbox/debian bionic contrib >> /etc/apt/sources.list" && sudo apt-get update && sudo apt-get install build-essential gcc make linux-headers-$(uname -r) virtualbox-6.0 && sudo usermod -aG vboxusers $(whoami)
  - export VER="1.5.1"
  - wget https://releases.hashicorp.com/packer/${VER}/packer_${VER}_linux_amd64.zip
  - unzip packer_${VER}_linux_amd64.zip
  - sudo mv packer /usr/local/bin
  - packer --version
  - git clone https://github.com/ssmirr/bento.git
  - cd bento/packer_templates/ubuntu
  - travis_wait 45 packer build -only=virtualbox-iso ubuntu-18.04-amd64.json

before_deploy:
  # Set up git user name and tag this commit
  - git config --local user.name "travis"
  - git config --local user.email "ssmirr@noreply.github.com"
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
  - git tag $TRAVIS_TAG
deploy:
  provider: releases
  api_key:
    secure: "L1534894g6bbT4/4qGfrA7EXaCJ8+9VszPB2hOsvegXSnNyEeRBbbrGRgXewUJnP7tM7OvhPWWBJaIV9j17K5Yeky4Z36N+6T+NxR9QRlSOYFaoh8YABu38wRSJ0mqy8tEdgO+G1L9hSBRL7bsU/6SWieLmEealNaJayLaUG16+9hXMNa4A/q09Ol2K3yd+V6QtqW4ZLMW8ZzVqhuft5WO+BWZJN6OcX56keylxxj76EpzWw1d8HvBYxgh6LHbVT0WbQ9L3qcWe39GnNLHav2LzdqoyV+pwwkESGukgWnD9xxxLs9J9CEm8p1DtoBIM3EtBUzsqNNbRv06gm8KgHjGwVWhjyIkO/LuHrm2OidXFqAJUWAIqf35y0WMIpKiqOv2umVGXw/JWNWQ/awrD4QJ0YjQUPwA8h/BgmIM6xxpFfR9yVr/BIofUEOL81YsZHQaLZLGx+H127sHSspGESFlTYts7hhvSv/CjJ8OX0aK05CDI4gTa8HI5RRzPdgMdmO3PENBLt1q3bbPFMY5vklX7MprFkaSenaGukGcTf3mnNbJLIp5Mfu/Znm/b3ADFVTgmF5BrHElP4s4vCUDjmx1b71dbKZXuNYteYMs8eoVS4ZzT7lrVM33K2vMSUYXNGf+EBCYWaEvQ4NmBtXXeSVrT7kVGLFqDJGXcgU/Q7ius="
  file: "../../builds/ubuntu-18.04.virtualbox.box"
  skip_cleanup: true
  overwrite: true
